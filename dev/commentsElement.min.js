/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */
var bearCMS=bearCMS||{};
bearCMS.commentsElement=bearCMS.commentsElement||function(){var e=function(a){clientShortcuts.get("users").then(function(b){var c=a.querySelector("textarea");b.currentUser.exists()?(c.removeAttribute("readonly"),c.style.cursor="auto",c.removeEventListener("click",d),a.querySelector(".bearcms-comments-element-send-button").style.removeProperty("display")):(c.setAttribute("readonly",!0),c.style.cursor="pointer",c.addEventListener("click",d),a.querySelector(".bearcms-comments-element-send-button").style.display="none")})},
d=function(){clientShortcuts.get("users").then(function(a){a.openLogin()})},f=function(a){clientShortcuts.get("-bearcms-html5domdocument").then(function(b){var c=document.getElementById(a.listElementID);b.insert(a.listContent,[c,"outerHTML"])})},g=function(a){a=a.target;var b=a.previousSibling;a.querySelector('[name="cfcontext"]').value=JSON.stringify({listElementID:b.id,listCommentsCount:b.getAttribute("data-count")})},h=function(a){var b=a.target;a=a.result;"undefined"!==typeof a.success&&(b.querySelector('[name="cfcomment"]').value=
"",f(a))};return{initialize:function(a){var b=document.getElementById(a);clientShortcuts.get("users").then(function(a){a.currentUser.addEventListener("change",function(){e(b)})});b.addEventListener("beforesubmit",g);b.addEventListener("submitsuccess",h);e(b)},loadMore:function(a,b){a.innerHTML+=" ...";var c=a.parentNode.parentNode,d={serverData:b.serverData,listElementID:c.id,listCommentsCount:parseInt(c.getAttribute("data-count"),10)+10};clientShortcuts.get("serverRequests").then(function(a){a.send("bearcms-comments-load-more",
d).then(function(a){a=JSON.parse(a);f(a)})})}}}();