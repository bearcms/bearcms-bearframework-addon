/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */
var bearCMS=bearCMS||{};
bearCMS.commentsElement=bearCMS.commentsElement||function(){var g=function(a){clientShortcuts.get("users").then(function(a){a.currentUser.exists()||a.openLogin()});return!1},f=function(a,d){clientShortcuts.get("-bearcms-html5domdocument").then(function(b){var c=document.getElementById(a.listElementID);b.insert(a.listContent,[c,"outerHTML"]);d()})},h=function(a){var d=a.target,b=a.result;"undefined"!==typeof b.noUser?(c(a),g()):"undefined"!==typeof b.success&&f(b,function(){c(a);d.reset()})},k=function(a){c(a)},
l=function(a){a=a.target;a.querySelector(".bearcms-comments-element-send-button").style.display="none";a.querySelector(".bearcms-comments-element-send-button-waiting").style.removeProperty("display");a.querySelector(".bearcms-comments-element-text-input").setAttribute("readonly","readonly")},c=function(a){a=a.target;a.querySelector(".bearcms-comments-element-send-button").style.removeProperty("display");a.querySelector(".bearcms-comments-element-send-button-waiting").style.display="none";a.querySelector(".bearcms-comments-element-text-input").removeAttribute("readonly")};
return{loadMore:function(a,d){a.target.innerHTML+=" ...";var b=a.target.parentNode.parentNode.id,c=parseInt(a.target.parentNode.parentNode.getAttribute("data-count"),10)+10,e=[];e.serverData=d.serverData;e.listElementID=b;e.listCommentsCount=c;clientShortcuts.get("serverRequests").then(function(a){a.send("bearcms-comments-load-more",e).then(function(a){a=JSON.parse(a);f(a,function(){})})})},onBeforeSubmitForm:function(a){var c=a.previousSibling.id,b=a.previousSibling.getAttribute("data-count");a.querySelector('input[type="hidden"]').value=
JSON.stringify({listElementID:c,listCommentsCount:b});"undefined"===typeof a.bearCMSCommentsEventsAttached&&(a.bearCMSCommentsEventsAttached=!0,a.addEventListener("submitstart",l),a.addEventListener("submitsuccess",h),a.addEventListener("submiterror",k))},onFocusTextarea:function(a){a=a.target.parentNode;"none"===a.querySelector(".bearcms-comments-element-send-button-waiting").style.display&&a.querySelector(".bearcms-comments-element-send-button").style.removeProperty("display")}}}();