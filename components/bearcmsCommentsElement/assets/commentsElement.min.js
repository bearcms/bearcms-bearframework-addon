/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */
var bearCMS=bearCMS||{};
bearCMS.commentsElement=function(){var c=function(a){if("undefined"!==typeof ivoPetkov.bearFrameworkAddons&&"undefined"!==typeof ivoPetkov.bearFrameworkAddons.users){var b=ivoPetkov.bearFrameworkAddons.users;if(!b.currentUser.exists())return b.showLogin(),a.preventDefault(),!0}return!1},f=function(a){var b=document.getElementById(a.listElementID);html5DOMDocument.insert(a.listContent);b.innerHTML=document.body.lastChild.innerHTML;b.setAttribute("data-count",document.body.lastChild.getAttribute("data-count"));document.body.lastChild.parentNode.removeChild(document.body.lastChild)};
return{loadMore:function(a,b){var e=a.target.parentNode.parentNode.id,c=parseInt(a.target.parentNode.parentNode.getAttribute("data-count"),10)+10,d=[];d.serverData=b.serverData;d.listElementID=e;d.listCommentsCount=c;ivoPetkov.bearFrameworkAddons.serverRequests.send("bearcms-comments-load-more",d,function(a){a=JSON.parse(a);f(a)})},onBeforeSubmitForm:function(a){if(!c(a)){var b=a.target.previousSibling.id,e=a.target.previousSibling.getAttribute("data-count");a.target.querySelector('input[type="hidden"]').value=
JSON.stringify({listElementID:b,listCommentsCount:e})}},onSubmitFormDone:function(a){var b=a.target;a=a.result;"undefined"!==typeof a.success&&b.reset();f(a)},onFormRequestSent:function(a){a=a.target;a.querySelector(".bearcms-comments-element-send-button").style.display="none";a.querySelector(".bearcms-comments-element-send-button-waiting").style.removeProperty("display");a.querySelector(".bearcms-comments-element-text-input").setAttribute("readonly","readonly")},onFormResponseReceived:function(a){a=
a.target;a.querySelector(".bearcms-comments-element-send-button").style.removeProperty("display");a.querySelector(".bearcms-comments-element-send-button-waiting").style.display="none";a.querySelector(".bearcms-comments-element-text-input").removeAttribute("readonly")},onFocusTextarea:function(a){c(a)&&a.target.blur();a=a.target.parentNode;"none"===a.querySelector(".bearcms-comments-element-send-button-waiting").style.display&&a.querySelector(".bearcms-comments-element-send-button").style.removeProperty("display")}}}();