/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */
var bearCMS=bearCMS||{};
bearCMS.commentsElement=bearCMS.commentsElement||function(){var e=[],g=function(a){var b="ur"+a;"undefined"===typeof e[b]&&(e[b]=1,b=document.getElementById(a),clientShortcuts.get("users").then(function(b){b.currentUser.addEventListener("change",function(){f(a,null)})}),b.addEventListener("beforesubmit",l),b.addEventListener("submitsuccess",m))},f=function(a,b){var c=function(b){var c=document.getElementById(a),d=c.querySelector("textarea");b?(d.removeAttribute("readonly"),d.style.cursor="auto",d.removeEventListener("click",
h),c.querySelector(".bearcms-comments-element-send-button").style.removeProperty("display")):(d.setAttribute("readonly",!0),d.style.cursor="pointer",d.addEventListener("click",h),c.querySelector(".bearcms-comments-element-send-button").style.display="none")};null!==b?c(b):clientShortcuts.get("users").then(function(a){c(a.currentUser.exists())})},h=function(a){var b=a.target.parentNode.parentNode.id;clientShortcuts.get("users").then(function(a){g(b);a.openLogin()})},k=function(a){clientShortcuts.get("-bearcms-html5domdocument").then(function(b){var c=
document.getElementById(a.listElementID);b.insert(a.listContent,[c,"outerHTML"])})},l=function(a){a=a.target;var b=a.previousSibling;a.querySelector('[name="cfcontext"]').value=JSON.stringify({listElementID:b.id,listCommentsCount:b.getAttribute("data-count")})},m=function(a){var b=a.target;a=a.result;"undefined"!==typeof a.success&&(b.querySelector('[name="cfcomment"]').value="",k(a))};return{initializeForm:function(a,b){f(a,b);if(b)return g(a)},loadMore:function(a,b){a.innerHTML+=" ...";var c=a.parentNode.parentNode,
e={serverData:b.serverData,listElementID:c.id,listCommentsCount:parseInt(c.getAttribute("data-count"),10)+10};clientShortcuts.get("serverRequests").then(function(a){a.send("bearcms-comments-load-more",e).then(function(a){a=JSON.parse(a);k(a)})})}}}();