/*
 * BearCMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) 2016 Amplilabs Ltd.
 * Free to use under the MIT license.
 */
var bearCMS=bearCMS||{};
bearCMS.commentsElement=function(){var e=function(a){var b=document.getElementById(a.listElementID);html5DOMDocument.insert(a.listContent);b.innerHTML=document.body.lastChild.innerHTML;b.setAttribute("data-count",document.body.lastChild.getAttribute("data-count"));document.body.lastChild.parentNode.removeChild(document.body.lastChild)};return{loadMore:function(a,b){var d=a.target.parentNode.parentNode.id,f=parseInt(a.target.parentNode.parentNode.getAttribute("data-count"),10)+10,c=[];c.serverData=
b.serverData;c.listElementID=d;c.listCommentsCount=f;ivoPetkov.bearFrameworkAddons.serverRequests.send("bearcms-comments-load-more",c,function(a){a=JSON.parse(a);e(a)})},onBeforeSubmitForm:function(a){if("undefined"!==typeof ivoPetkov.bearFrameworkAddons&&"undefined"!==typeof ivoPetkov.bearFrameworkAddons.users){var b=ivoPetkov.bearFrameworkAddons.users;if(!b.currentUser.exists()){b.showLogin();a.preventDefault();return}}b=a.target.previousSibling.id;var d=a.target.previousSibling.getAttribute("data-count");
a.target.querySelector('input[type="hidden"]').value=JSON.stringify({listElementID:b,listCommentsCount:d})},onSubmitFormDone:function(a){var b=a.target;a=a.result;"undefined"!==typeof a.success&&b.reset();e(a)},onFormRequestSent:function(a){a=a.target;a.querySelector(".bearcms-comments-element-send-button").style.display="none";a.querySelector(".bearcms-comments-element-send-button-waiting").style.display="inline-block";a.querySelector(".bearcms-comments-element-text-input").setAttribute("readonly",
"readonly")},onFormResponseReceived:function(a){a=a.target;a.querySelector(".bearcms-comments-element-send-button").style.display="inline-block";a.querySelector(".bearcms-comments-element-send-button-waiting").style.display="none";a.querySelector(".bearcms-comments-element-text-input").removeAttribute("readonly")},onFocusTextarea:function(a){a=a.target.parentNode;"none"===a.querySelector(".bearcms-comments-element-send-button-waiting").style.display&&(a.querySelector(".bearcms-comments-element-send-button").style.display=
"inline-block")}}}();