<?php

/*
 * Bear CMS addon for Bear Framework
 * https://bearcms.com/
 * Copyright (c) Amplilabs Ltd.
 * Free to use under the MIT license.
 */

return <<<'EOT'
var bearCMS=bearCMS||{};
bearCMS.commentsElementForm=bearCMS.commentsElementForm||function(){var g=[],k=function(a){var b="ur"+a;"undefined"===typeof g[b]&&(g[b]=1,b=document.getElementById(a),clientPackages.get("users").then(function(c){c.currentUser.addEventListener("change",function(){h(a,null)})}),b.addEventListener("beforesubmit",m),b.addEventListener("submitsuccess",n))},h=function(a,b){var c=function(d){var e=document.getElementById(a),f=e.querySelector("textarea");d?(f.removeAttribute("readonly"),f.style.cursor="auto",
f.removeEventListener("click",l),e.querySelector(".bearcms-comments-element-send-button").style.removeProperty("display")):(f.setAttribute("readonly",!0),f.style.cursor="pointer",f.addEventListener("click",l),e.querySelector(".bearcms-comments-element-send-button").style.display="none")};null!==b?c(b):clientPackages.get("users").then(function(d){d.currentUser.exists().then(function(e){c(e)})})},l=function(a){clientPackages.get("lightbox").then(function(b){b.make();var c=a.target.closest("form").id;
clientPackages.get("users").then(function(d){k(c);d.openLogin()})})},m=function(a){a=a.target;var b=a.previousSibling;a.querySelector('[name="cfcontext"]').value=JSON.stringify({listElementID:b.id,listCommentsCount:b.getAttribute("data-count")})},n=function(a){var b=a.target,c=a.result;"undefined"!==typeof c.success&&(b.querySelector('[name="cfcomment"]').value="",clientPackages.get("-bearcms-html5domdocument").then(function(d){var e=document.getElementById(c.listElementID);d.insert(c.listContent,
[e,"outerHTML"])}))};return{initialize:function(a,b){h(a,b);b&&k(a)}}}();
EOT;
